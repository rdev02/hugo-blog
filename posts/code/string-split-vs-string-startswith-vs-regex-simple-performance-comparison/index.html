<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>String.split() VS String.startsWith() VS Regex simple performance comparison. | Nomad&#39;s reflections</title>
<meta name="keywords" content="java, perf, csharp">
<meta name="description" content="Now really, what would be faster/more reliable for a typical not so complicated and not over-simple case? Yes the one we tend to deal with in our day-to-day work? For those impatient benchmarks are here.Reading a 100/1000-line file is not fun and I really think you shouldn‚Äôt bother choosing if you‚Äôre dealing with such volumes of data. But if you have to parse 320k-500k records lines, which, in fact, is not that large ‚Äì 320k of CSV data is ~ 12MB performance is considerable.">
<meta name="author" content="Viktor Halitsyn">
<link rel="canonical" href="https://blog.vnomad.com/posts/code/string-split-vs-string-startswith-vs-regex-simple-performance-comparison/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css" integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://blog.vnomad.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://blog.vnomad.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://blog.vnomad.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://blog.vnomad.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://blog.vnomad.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://blog.vnomad.com/posts/code/string-split-vs-string-startswith-vs-regex-simple-performance-comparison/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
  
    
      
    
  

<meta property="og:title" content="String.split() VS String.startsWith() VS Regex simple performance comparison." />
<meta property="og:description" content="Now really, what would be faster/more reliable for a typical not so complicated and not over-simple case? Yes the one we tend to deal with in our day-to-day work? For those impatient benchmarks are here.Reading a 100/1000-line file is not fun and I really think you shouldn‚Äôt bother choosing if you‚Äôre dealing with such volumes of data. But if you have to parse 320k-500k records lines, which, in fact, is not that large ‚Äì 320k of CSV data is ~ 12MB performance is considerable." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.vnomad.com/posts/code/string-split-vs-string-startswith-vs-regex-simple-performance-comparison/" />
<meta property="og:image" content="https://s3-us-west-2.amazonaws.com/vnomad-public/blog_infra/wp_back3.jpg" />
<meta property="article:section" content="posts" />
<meta property="article:published_time" content="2011-04-19T14:45:00+00:00" />
<meta property="article:modified_time" content="2011-04-19T14:45:00+00:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://s3-us-west-2.amazonaws.com/vnomad-public/blog_infra/wp_back3.jpg" />
<meta name="twitter:title" content="String.split() VS String.startsWith() VS Regex simple performance comparison."/>
<meta name="twitter:description" content="Now really, what would be faster/more reliable for a typical not so complicated and not over-simple case? Yes the one we tend to deal with in our day-to-day work? For those impatient benchmarks are here.Reading a 100/1000-line file is not fun and I really think you shouldn‚Äôt bother choosing if you‚Äôre dealing with such volumes of data. But if you have to parse 320k-500k records lines, which, in fact, is not that large ‚Äì 320k of CSV data is ~ 12MB performance is considerable."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://blog.vnomad.com/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "String.split() VS String.startsWith() VS Regex simple performance comparison.",
      "item": "https://blog.vnomad.com/posts/code/string-split-vs-string-startswith-vs-regex-simple-performance-comparison/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "String.split() VS String.startsWith() VS Regex simple performance comparison.",
  "name": "String.split() VS String.startsWith() VS Regex simple performance comparison.",
  "description": "Now really, what would be faster/more reliable for a typical not so complicated and not over-simple case? Yes the one we tend to deal with in our day-to-day work? For those impatient benchmarks are here.Reading a 100/1000-line file is not fun and I really think you shouldn‚Äôt bother choosing if you‚Äôre dealing with such volumes of data. But if you have to parse 320k-500k records lines, which, in fact, is not that large ‚Äì 320k of CSV data is ~ 12MB performance is considerable.",
  "keywords": [
    "java", "perf", "csharp"
  ],
  "articleBody": "Now really, what would be faster/more reliable for a typical not so complicated and not over-simple case? Yes the one we tend to deal with in our day-to-day work? For those impatient benchmarks are here.Reading a 100/1000-line file is not fun and I really think you shouldn‚Äôt bother choosing if you‚Äôre dealing with such volumes of data. But if you have to parse 320k-500k records lines, which, in fact, is not that large ‚Äì 320k of CSV data is ~ 12MB performance is considerable. So let‚Äôs start with data definition. Let‚Äôs assume we have data like\n1812332,‚ÄùString1‚Ä≥,‚ÄùString2‚Ä≥,‚ÄùString3‚Ä≥,16,\n1812332,‚ÄùString1‚Ä≥,‚ÄùString2‚Ä≥,‚ÄùString3‚Ä≥,16,\n1812332,‚ÄùString1‚Ä≥,‚ÄùString2, extra string‚Äù,‚ÄùString3‚Ä≥,16,\nAlso we are going to start with the abstract ‚Äúblank‚Äù for csv reading like:\npublic abstract class CsvStreamReader implements Iterator\u003cCsvData\u003e { protected BufferedReader reader; /** * creates an new {@code CsvStreamReader}. Caller is responsible for stream management. * */ public CsvStreamReader() { } public abstract CsvData next(); public boolean hasNext() { try { return reader.ready(); } catch (IOException e) { e.printStackTrace(); } return false; } @Deprecated public void remove() { // not used } public void setInputStream(InputStream inputStream){ reader = new BufferedReader(new InputStreamReader(inputStream)); } } And a simple data-holder like:\npublic class CsvData { private String[] data; public CsvData(String... data) { this.data = new String[data.length]; System.arraycopy(data, 0, this.data, 0, data.length); } public String getColumn(int index) { return data[index]; } public int getColumnCount() { return data.length; } @Override public String toString() { return \"CsvData{\" + \"data=\" + (data == null ? null : Arrays.asList(data)) + '}'; } } Now the first and obvious way to read and parse the CSV would be smth like:\npublic class SplitBasedReader extends CsvStreamReader { public CsvData next() { try { String line = reader.readLine(); return new CsvData(line.split(\",\")); } catch (IOException e) { e.printStackTrace(); } return null; } } This looks fairly good with one lil‚Äô problem: it doesn‚Äôt work good. If we take the last line with ‚ÄúString2, extra string‚Äù we see that the split would play a bad trick with us breaking the data consistency.\nA quick fix would suggest smth like:\npublic class StringBasedReader extends CsvStreamReader { private static final String QUOTE = \"\"\"; @Override public CsvData next() { try { List\u003cString\u003e data = new ArrayList\u003cString\u003e(); final String line = reader.readLine(); int commaStart = 0; int commaEnd = 0; StringBuffer possibleToken = new StringBuffer(); while (commaEnd \u003e= 0) { commaEnd = line.indexOf(',', commaStart + 1); if (commaEnd \u003c 0) { break; } final String possibleColumn = line.substring(commaStart, commaEnd); possibleToken.append(possibleColumn); commaStart = commaEnd + 1; final int length = possibleToken.length(); boolean columnIsOpen = (possibleColumn.startsWith(QUOTE)) \u0026\u0026 (!(possibleColumn.endsWith(QUOTE))); if (!columnIsOpen) { data.add(possibleToken.toString()); possibleToken.delete(0, length); } } if (possibleToken.length() != 0) { data.add(possibleToken.toString()); } return new CsvData(data.toArray(new String[]{})); } catch (IOException ioex) { ioex.printStackTrace(); } return null; } } Well yeah, but having string.startsWith checking on String all this takes int account variable length which in fact we do not care about‚Ä¶ sounds wasteful. Let‚Äôs improve it.\npublic class StringBasedReaderImproved extends CsvStreamReader { private static final char QUOTE = '\"'; @Override public CsvData next() { try { List\u003cString\u003e data = new ArrayList\u003cString\u003e(); final String line = reader.readLine(); int commaStart = 0; int commaEnd = 0; StringBuffer possibleToken = new StringBuffer(); while (commaEnd \u003e= 0) { commaEnd = line.indexOf(',', commaStart + 1); if (commaEnd \u003c 0) { break; } possibleToken.append(line.substring(commaStart, commaEnd)); commaStart = commaEnd + 1; final int length = possibleToken.length(); boolean columnIsOpen = (possibleToken.charAt(0) == QUOTE) \u0026\u0026 (!(possibleToken.charAt(length - 1) == QUOTE)); if (!columnIsOpen) { data.add(possibleToken.toString()); possibleToken.delete(0, length); } } if (possibleToken.length() != 0) { data.add(possibleToken.toString()); } return new CsvData(data.toArray(new String[]{})); } catch (IOException ioex) { ioex.printStackTrace(); } return null; } } OKAY! now it a char and StringBuffer. Looks like we‚Äôve done a great job! Awesome‚Ä¶. although a bit magical. It‚Äôs not rocket science but still it‚Äôs not pleasant to read. What else might we suggest? Regex.\npublic class RegexBasedReader extends CsvStreamReader { private static final String RE_ANY_INSIDE_QUOTES = \"\"([^\"]*)\"\"; private static final String RE_ANY_WITHOUT_COMMAS = \"([^,]*)\"; private static final String RE_ANY = \"(\" + RE_ANY_INSIDE_QUOTES + \"|\" + RE_ANY_WITHOUT_COMMAS + \")\"; private static final String RE_6_DIGIT_GROUP = \"(\\d{6})\"; private static final String CSV_REGEX = \"^\" + RE_6_DIGIT_GROUP + \",\" + RE_ANY + \",\" + RE_ANY + \",\" + RE_ANY + \",\" + RE_ANY + \",$\"; protected final Pattern pattern; /** * {@inheritDoc} */ public RegexBasedReader() { pattern = Pattern.compile(CSV_REGEX); } public CsvData next() { try { List\u003cString\u003e data = new ArrayList\u003cString\u003e(); final String line = reader.readLine(); final Matcher matcher = pattern.matcher(line); matchDataToColumns(data, matcher); return new CsvData(data.toArray(new String[]{})); } catch (IOException e) { e.printStackTrace(); } return null; } /** * @param data * @param matcher */ protected void matchDataToColumns(List\u003cString\u003e data, Matcher matcher) { if (matcher.matches()) { final int groupCount = matcher.groupCount(); assert groupCount == 13 : \"Matched an invalid string - regex should be revised\"; final String data1 = matcher.group(1); assert data1 != null : \"data1 should always be present\"; data.add(data1); String data2 = matcher.group(3); if (data2 == null) { data2 = matcher.group(4); } assert data2 != null : \"data2 should somehow be present\"; data.add(data2); String data3 = matcher.group(6); if (data3 == null) { data3 = matcher.group(7); } assert data3 != null : \"data3 should somehow be present\"; data.add(data3); String data4 = matcher.group(9); if (data4 == null) { data4 = matcher.group(10); } assert data4 != null : \"data4 should somehow be present\"; data.add(data4); String data5 = matcher.group(12); if (data5 == null) { data5 = matcher.group(13); } assert data5 != null : \"data5 should somehow be present\"; data.add(data5); } } } That looks like Chuck Norris would be proud. Strong and reliable checking, precompiled patern, groups of data, many cases handled same way‚Ä¶ room for extension etc.\n*Now lets look at the benchmarks reading over 500k lines:\npublic class Test2 { static List times = new ArrayList(4); public static void main(String[] args) throws IOException { read320KRecords(new SplitBasedReader()); read320KRecords(new StringBasedReader()); read320KRecords(new StringBasedReaderImproved()); read320KRecords(new RegexBasedReader()); } private static void read320KRecords(CsvStreamReader reader) throws IOException { InputStream inputStream = Test2.class.getResourceAsStream(\"/CardInfo.csv\"); reader.setInputStream(inputStream); long timeStart = System.currentTimeMillis(); while (reader.hasNext()) { CsvData csvData = reader.next(); } long timeEnd = System.currentTimeMillis(); times.add(reader.toString() + \" time: \" + (new DecimalFormat(\"#.####\")).format(new Double( (timeEnd - timeStart) / 1000.0)) + \" sec.\"); inputStream.close(); } } Output run from IntellyJ Idea:\nSplitBasedReader StringBasedReader StringBasedReaderImproved RegexBasedReader Run 1 1.468 0.968 0.984 1.593 Run 2 1.562 0.953 0.985 1.594 Run 3 1.531 1.031 1.047 1.625 In a chart:\nBut wait ‚Äì there‚Äôs more üôÇ\nNow let‚Äôs see if we can get even more results out of this. In the previous benchmark runs we did nothing with the CsvData we obtained, but that is not the case in real world right? now consider we add a single\nSystem.out.println(\"csvData = \" + csvData); and this would always result in ‚ÄúcsvData = myCSvData‚Äù.\nRunning this in IDEA gives next results:\nSplitBasedReader time: 14.634 sec.\nStringBasedReader time: 13.086 sec\nStringBasedReaderImproved time: 12.118 sec\nRegexBasedReader time: 15.244 sec\n**SAME but in console: **\nSplitBasedReader time: 138.025 sec.\nStringBasedReader time: 136.337 sec.\nStringBasedReaderImproved time: 130.975 sec.\nRegexBasedReader time: 131.146 sec.\nSo we see that the buffers and IO impact is immense.\nAnd one more test. Lets assume out toString is smth. a little meaningful like\n\"CsvData{\" + data[0] + data[1] + data[2]; Now the times(idea env execution) are:\nSplitBasedReader time: 21.655 sec.\nStringBasedReader time: 9.772 sec.\nStringBasedReaderImproved time: 9.256 sec.\nRegexBasedReader time: 12.461 sec.\nBottom line:\nWhile robust and effective Regex is not the fastest thing in the world;\nworking with relatively not-so-complex data is faster with ‚Äúsmaller‚Äù API‚Äôs;\n;\nIO is a bottleneck, not the parsing, usually.\n",
  "wordCount" : "1274",
  "inLanguage": "en",
  "image": "https://s3-us-west-2.amazonaws.com/vnomad-public/blog_infra/wp_back3.jpg","datePublished": "2011-04-19T14:45:00Z",
  "dateModified": "2011-04-19T14:45:00Z",
  "author":{
    "@type": "Person",
    "name": "Viktor Halitsyn"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://blog.vnomad.com/posts/code/string-split-vs-string-startswith-vs-regex-simple-performance-comparison/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Nomad's reflections",
    "logo": {
      "@type": "ImageObject",
      "url": "https://blog.vnomad.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://blog.vnomad.com/" accesskey="h" title="Nomad&#39;s reflections (Alt + H)">Nomad&#39;s reflections</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://blog.vnomad.com/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://blog.vnomad.com/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://blog.vnomad.com/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://blog.vnomad.com/">Home</a>&nbsp;¬ª&nbsp;<a href="https://blog.vnomad.com/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      String.split() VS String.startsWith() VS Regex simple performance comparison.
    </h1>
    <div class="post-meta"><span title='2011-04-19 14:45:00 +0000 +0000'>04/19/2011</span>&nbsp;¬∑&nbsp;6 min&nbsp;¬∑&nbsp;Viktor Halitsyn&nbsp;|&nbsp;<a href="https://github.com/rdev02/hugo-blog/tree/master/content/posts/code/string-split-vs-string-startswith-vs-regex-simple-performance-comparison.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> 
  <div class="post-content"><p>Now really, what would be faster/more reliable for a typical not so complicated and not over-simple case? Yes the one we tend to deal with in our day-to-day work? For those impatient <a href="https://blog.vnomad.com/#benchmarks">benchmarks are here</a>.Reading a 100/1000-line file is not fun and I really think you shouldn‚Äôt bother choosing if you‚Äôre dealing with such volumes of data. But if you have to parse 320k-500k records lines, which, in fact, is not that large ‚Äì 320k of CSV data is ~ 12MB performance is considerable. So let‚Äôs start with data definition. Let‚Äôs assume we have data like</p>
<blockquote>
<p>1812332,‚ÄùString1‚Ä≥,‚ÄùString2‚Ä≥,‚ÄùString3‚Ä≥,16,</p>
</blockquote>
<blockquote>
<p>1812332,‚ÄùString1‚Ä≥,‚ÄùString2‚Ä≥,‚ÄùString3‚Ä≥,16,</p>
</blockquote>
<blockquote>
<p>1812332,‚ÄùString1‚Ä≥,‚ÄùString2, extra string‚Äù,‚ÄùString3‚Ä≥,16,</p>
</blockquote>
<p>Also we are going to start with the abstract ‚Äúblank‚Äù for csv reading like:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cs" data-lang="cs"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">abstract</span> <span class="k">class</span> <span class="nc">CsvStreamReader</span> <span class="n">implements</span> <span class="n">Iterator</span><span class="p">&lt;</span><span class="n">CsvData</span><span class="p">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="n">BufferedReader</span> <span class="n">reader</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * creates an new {@code CsvStreamReader}. Caller is responsible for stream management.
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">CsvStreamReader</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">abstract</span> <span class="n">CsvData</span> <span class="n">next</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">boolean</span> <span class="n">hasNext</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">reader</span><span class="p">.</span><span class="n">ready</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">IOException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">e</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">@Deprecated</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">void</span> <span class="k">remove</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// not used</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">void</span> <span class="n">setInputStream</span><span class="p">(</span><span class="n">InputStream</span> <span class="n">inputStream</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="n">reader</span> <span class="p">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="p">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="p">(</span><span class="n">inputStream</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>And a simple data-holder like:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cs" data-lang="cs"><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">CsvData</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span><span class="p">[]</span> <span class="n">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">CsvData</span><span class="p">(</span><span class="n">String</span><span class="p">...</span> <span class="n">data</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="n">data</span> <span class="p">=</span> <span class="k">new</span> <span class="n">String</span><span class="p">[</span><span class="n">data</span><span class="p">.</span><span class="n">length</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="p">.</span><span class="n">arraycopy</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">data</span><span class="p">.</span><span class="n">length</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="n">getColumn</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="n">getColumnCount</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">data</span><span class="p">.</span><span class="n">length</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="n">toString</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;CsvData{&#34;</span> <span class="p">+</span>
</span></span><span class="line"><span class="cl">          <span class="s">&#34;data=&#34;</span> <span class="p">+</span> <span class="p">(</span><span class="n">data</span> <span class="p">==</span> <span class="kc">null</span> <span class="p">?</span> <span class="kc">null</span> <span class="p">:</span> <span class="n">Arrays</span><span class="p">.</span><span class="n">asList</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="p">+</span>
</span></span><span class="line"><span class="cl">          <span class="sc">&#39;}&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Now the first and obvious way to read and parse the CSV would be smth like:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cs" data-lang="cs"><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">SplitBasedReader</span> <span class="n">extends</span> <span class="n">CsvStreamReader</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">CsvData</span> <span class="n">next</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">String</span> <span class="n">line</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="n">readLine</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">new</span> <span class="n">CsvData</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#34;,&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">IOException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">e</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>This looks fairly good with one lil‚Äô problem: it doesn‚Äôt work good. If we take the last line with ‚ÄúString2, extra string‚Äù we see that the split would play a bad trick with us breaking the data consistency.</p>
<p>A quick fix would suggest smth like:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cs" data-lang="cs"><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">StringBasedReader</span> <span class="n">extends</span> <span class="n">CsvStreamReader</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="n">final</span> <span class="n">String</span> <span class="n">QUOTE</span> <span class="p">=</span> <span class="s">&#34;&#34;&#34;;
</span></span></span><span class="line"><span class="cl"><span class="s"></span>
</span></span><span class="line"><span class="cl">    <span class="n">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">CsvData</span> <span class="n">next</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">List</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;</span> <span class="n">data</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;();</span>
</span></span><span class="line"><span class="cl">            <span class="n">final</span> <span class="n">String</span> <span class="n">line</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="n">readLine</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="kt">int</span> <span class="n">commaStart</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kt">int</span> <span class="n">commaEnd</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">StringBuffer</span> <span class="n">possibleToken</span> <span class="p">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">while</span> <span class="p">(</span><span class="n">commaEnd</span> <span class="p">&gt;=</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">commaEnd</span> <span class="p">=</span> <span class="n">line</span><span class="p">.</span><span class="n">indexOf</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">,</span> <span class="n">commaStart</span> <span class="p">+</span> <span class="m">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="n">commaEnd</span> <span class="p">&lt;</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="n">final</span> <span class="n">String</span> <span class="n">possibleColumn</span> <span class="p">=</span> <span class="n">line</span><span class="p">.</span><span class="n">substring</span><span class="p">(</span><span class="n">commaStart</span><span class="p">,</span> <span class="n">commaEnd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">possibleToken</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">possibleColumn</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">commaStart</span> <span class="p">=</span> <span class="n">commaEnd</span> <span class="p">+</span> <span class="m">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="n">final</span> <span class="kt">int</span> <span class="n">length</span> <span class="p">=</span> <span class="n">possibleToken</span><span class="p">.</span><span class="n">length</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="n">boolean</span> <span class="n">columnIsOpen</span> <span class="p">=</span> <span class="p">(</span><span class="n">possibleColumn</span><span class="p">.</span><span class="n">startsWith</span><span class="p">(</span><span class="n">QUOTE</span><span class="p">))</span> <span class="p">&amp;&amp;</span> <span class="p">(!(</span><span class="n">possibleColumn</span><span class="p">.</span><span class="n">endsWith</span><span class="p">(</span><span class="n">QUOTE</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(!</span><span class="n">columnIsOpen</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">data</span><span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="n">possibleToken</span><span class="p">.</span><span class="n">toString</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">                    <span class="n">possibleToken</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">possibleToken</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">data</span><span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="n">possibleToken</span><span class="p">.</span><span class="n">toString</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">new</span> <span class="n">CsvData</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">toArray</span><span class="p">(</span><span class="k">new</span> <span class="n">String</span><span class="p">[]{}));</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">IOException</span> <span class="n">ioex</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">ioex</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Well yeah, but having string.startsWith checking on String all this takes int account variable length which in fact we do not care about‚Ä¶ sounds wasteful. Let‚Äôs improve it.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cs" data-lang="cs"><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">StringBasedReaderImproved</span> <span class="n">extends</span> <span class="n">CsvStreamReader</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="n">final</span> <span class="kt">char</span> <span class="n">QUOTE</span> <span class="p">=</span> <span class="sc">&#39;&#34;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">CsvData</span> <span class="n">next</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">List</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;</span> <span class="n">data</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;();</span>
</span></span><span class="line"><span class="cl">            <span class="n">final</span> <span class="n">String</span> <span class="n">line</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="n">readLine</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="kt">int</span> <span class="n">commaStart</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kt">int</span> <span class="n">commaEnd</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">StringBuffer</span> <span class="n">possibleToken</span> <span class="p">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">while</span> <span class="p">(</span><span class="n">commaEnd</span> <span class="p">&gt;=</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">commaEnd</span> <span class="p">=</span> <span class="n">line</span><span class="p">.</span><span class="n">indexOf</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">,</span> <span class="n">commaStart</span> <span class="p">+</span> <span class="m">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="n">commaEnd</span> <span class="p">&lt;</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="n">possibleToken</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="n">substring</span><span class="p">(</span><span class="n">commaStart</span><span class="p">,</span> <span class="n">commaEnd</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">                <span class="n">commaStart</span> <span class="p">=</span> <span class="n">commaEnd</span> <span class="p">+</span> <span class="m">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="n">final</span> <span class="kt">int</span> <span class="n">length</span> <span class="p">=</span> <span class="n">possibleToken</span><span class="p">.</span><span class="n">length</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">                <span class="n">boolean</span> <span class="n">columnIsOpen</span> <span class="p">=</span> <span class="p">(</span><span class="n">possibleToken</span><span class="p">.</span><span class="n">charAt</span><span class="p">(</span><span class="m">0</span><span class="p">)</span> <span class="p">==</span> <span class="n">QUOTE</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="p">(!(</span><span class="n">possibleToken</span><span class="p">.</span><span class="n">charAt</span><span class="p">(</span><span class="n">length</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span> <span class="p">==</span> <span class="n">QUOTE</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(!</span><span class="n">columnIsOpen</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">data</span><span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="n">possibleToken</span><span class="p">.</span><span class="n">toString</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">                    <span class="n">possibleToken</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">possibleToken</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">data</span><span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="n">possibleToken</span><span class="p">.</span><span class="n">toString</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">new</span> <span class="n">CsvData</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">toArray</span><span class="p">(</span><span class="k">new</span> <span class="n">String</span><span class="p">[]{}));</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">IOException</span> <span class="n">ioex</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">ioex</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>OKAY! now it a char and <code>StringBuffer</code>. Looks like we‚Äôve done a great job! Awesome‚Ä¶. although a bit magical. It‚Äôs not rocket science but still it‚Äôs not pleasant to read. What else might we suggest? Regex.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cs" data-lang="cs"><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">RegexBasedReader</span> <span class="n">extends</span> <span class="n">CsvStreamReader</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="n">final</span> <span class="n">String</span> <span class="n">RE_ANY_INSIDE_QUOTES</span> <span class="p">=</span> <span class="s">&#34;&#34;</span><span class="p">([^</span><span class="s">&#34;]*)&#34;&#34;;
</span></span></span><span class="line"><span class="cl"><span class="s"></span>    <span class="kd">private</span> <span class="kd">static</span> <span class="n">final</span> <span class="n">String</span> <span class="n">RE_ANY_WITHOUT_COMMAS</span> <span class="p">=</span> <span class="s">&#34;([^,]*)&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="n">final</span> <span class="n">String</span> <span class="n">RE_ANY</span> <span class="p">=</span> <span class="s">&#34;(&#34;</span> <span class="p">+</span> <span class="n">RE_ANY_INSIDE_QUOTES</span> <span class="p">+</span> <span class="s">&#34;|&#34;</span> <span class="p">+</span> <span class="n">RE_ANY_WITHOUT_COMMAS</span> <span class="p">+</span> <span class="s">&#34;)&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="n">final</span> <span class="n">String</span> <span class="n">RE_6_DIGIT_GROUP</span> <span class="p">=</span> <span class="s">&#34;(\d{6})&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="n">final</span> <span class="n">String</span> <span class="n">CSV_REGEX</span> <span class="p">=</span> <span class="s">&#34;^&#34;</span> <span class="p">+</span> <span class="n">RE_6_DIGIT_GROUP</span> <span class="p">+</span> <span class="s">&#34;,&#34;</span> <span class="p">+</span> <span class="n">RE_ANY</span> <span class="p">+</span> <span class="s">&#34;,&#34;</span> <span class="p">+</span> <span class="n">RE_ANY</span> <span class="p">+</span> <span class="s">&#34;,&#34;</span> <span class="p">+</span> <span class="n">RE_ANY</span> <span class="p">+</span> <span class="s">&#34;,&#34;</span> <span class="p">+</span> <span class="n">RE_ANY</span> <span class="p">+</span> <span class="s">&#34;,$&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="n">final</span> <span class="n">Pattern</span> <span class="n">pattern</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * {@inheritDoc}
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">RegexBasedReader</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">pattern</span> <span class="p">=</span> <span class="n">Pattern</span><span class="p">.</span><span class="n">compile</span><span class="p">(</span><span class="n">CSV_REGEX</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">CsvData</span> <span class="n">next</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">List</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;</span> <span class="n">data</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;();</span>
</span></span><span class="line"><span class="cl">            <span class="n">final</span> <span class="n">String</span> <span class="n">line</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="n">readLine</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">final</span> <span class="n">Matcher</span> <span class="n">matcher</span> <span class="p">=</span> <span class="n">pattern</span><span class="p">.</span><span class="n">matcher</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">matchDataToColumns</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">matcher</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">new</span> <span class="n">CsvData</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">toArray</span><span class="p">(</span><span class="k">new</span> <span class="n">String</span><span class="p">[]{}));</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">IOException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">e</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param data
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param matcher
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="k">void</span> <span class="n">matchDataToColumns</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;</span> <span class="n">data</span><span class="p">,</span> <span class="n">Matcher</span> <span class="n">matcher</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">matcher</span><span class="p">.</span><span class="n">matches</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">final</span> <span class="kt">int</span> <span class="n">groupCount</span> <span class="p">=</span> <span class="n">matcher</span><span class="p">.</span><span class="n">groupCount</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">assert</span> <span class="n">groupCount</span> <span class="p">==</span> <span class="m">13</span> <span class="p">:</span> <span class="s">&#34;Matched an invalid string - regex should be revised&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">final</span> <span class="n">String</span> <span class="n">data1</span> <span class="p">=</span> <span class="n">matcher</span><span class="p">.</span><span class="k">group</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">assert</span> <span class="n">data1</span> <span class="p">!=</span> <span class="kc">null</span> <span class="p">:</span> <span class="s">&#34;data1 should always be present&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">data</span><span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="n">data1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">String</span> <span class="n">data2</span> <span class="p">=</span> <span class="n">matcher</span><span class="p">.</span><span class="k">group</span><span class="p">(</span><span class="m">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">data2</span> <span class="p">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">data2</span> <span class="p">=</span> <span class="n">matcher</span><span class="p">.</span><span class="k">group</span><span class="p">(</span><span class="m">4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">assert</span> <span class="n">data2</span> <span class="p">!=</span> <span class="kc">null</span> <span class="p">:</span> <span class="s">&#34;data2 should somehow be present&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">data</span><span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="n">data2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">String</span> <span class="n">data3</span> <span class="p">=</span> <span class="n">matcher</span><span class="p">.</span><span class="k">group</span><span class="p">(</span><span class="m">6</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">data3</span> <span class="p">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">data3</span> <span class="p">=</span> <span class="n">matcher</span><span class="p">.</span><span class="k">group</span><span class="p">(</span><span class="m">7</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">assert</span> <span class="n">data3</span> <span class="p">!=</span> <span class="kc">null</span> <span class="p">:</span> <span class="s">&#34;data3 should somehow be present&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">data</span><span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="n">data3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">String</span> <span class="n">data4</span> <span class="p">=</span> <span class="n">matcher</span><span class="p">.</span><span class="k">group</span><span class="p">(</span><span class="m">9</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">data4</span> <span class="p">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">data4</span> <span class="p">=</span> <span class="n">matcher</span><span class="p">.</span><span class="k">group</span><span class="p">(</span><span class="m">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">assert</span> <span class="n">data4</span> <span class="p">!=</span> <span class="kc">null</span> <span class="p">:</span> <span class="s">&#34;data4 should somehow be present&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">data</span><span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="n">data4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">String</span> <span class="n">data5</span> <span class="p">=</span> <span class="n">matcher</span><span class="p">.</span><span class="k">group</span><span class="p">(</span><span class="m">12</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">data5</span> <span class="p">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">data5</span> <span class="p">=</span> <span class="n">matcher</span><span class="p">.</span><span class="k">group</span><span class="p">(</span><span class="m">13</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">assert</span> <span class="n">data5</span> <span class="p">!=</span> <span class="kc">null</span> <span class="p">:</span> <span class="s">&#34;data5 should somehow be present&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">data</span><span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="n">data5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>That looks like Chuck Norris would be proud. Strong and reliable checking, precompiled patern, groups of data, many cases handled same way‚Ä¶ room for extension etc.</p>
<ul>
<li>
<ul>
<li>*Now lets look at the</li>
</ul>
</li>
</ul>
<p><strong>benchmarks</strong> reading over <strong>500k</strong> lines:</p>
</p> 
<pre tabindex="0"><code>public class Test2 {
    static List&lt;string&gt; times = new ArrayList&lt;string&gt;(4);

    public static void main(String[] args) throws IOException {

        read320KRecords(new SplitBasedReader());
        read320KRecords(new StringBasedReader());
        read320KRecords(new StringBasedReaderImproved());
        read320KRecords(new RegexBasedReader());
}

    private static void read320KRecords(CsvStreamReader reader) throws IOException {
        InputStream inputStream = Test2.class.getResourceAsStream(&#34;/CardInfo.csv&#34;);
        reader.setInputStream(inputStream);
        long timeStart = System.currentTimeMillis();
        while (reader.hasNext()) {
            CsvData csvData = reader.next();
        }
        long timeEnd = System.currentTimeMillis();
        times.add(reader.toString() + &#34;  time: &#34; + (new DecimalFormat(&#34;#.####&#34;)).format(new Double(
          (timeEnd - timeStart) / 1000.0)) + &#34; sec.&#34;);
        inputStream.close();
    }
}
</code></pre><p><a href="http://www.blogger.com/post-create.g?blogID=4242186654644920321" name="benchmarks">Output <i>run from IntellyJ Idea</i>:</a></p>
<table border="1" cellpadding="0" cellspacing="0">
  <tr>
    <td>
<pre><code>&lt;/td&gt;

&lt;td&gt;
  &lt;b&gt;SplitBasedReader&lt;/b&gt;
&lt;/td&gt;

&lt;td&gt;
  &lt;b&gt;StringBasedReader&lt;/b&gt;
&lt;/td&gt;

&lt;td&gt;
  &lt;b&gt;StringBasedReaderImproved&lt;/b&gt;
&lt;/td&gt;

&lt;td&gt;
  &lt;b&gt;RegexBasedReader&lt;/b&gt;
&lt;/td&gt;
</code></pre>
  </tr>
  <tr>
    <td>
      Run 1
    </td>
<pre><code>&lt;td&gt;
  1.468
&lt;/td&gt;

&lt;td&gt;
  0.968
&lt;/td&gt;

&lt;td&gt;
  0.984
&lt;/td&gt;

&lt;td&gt;
  1.593
&lt;/td&gt;
</code></pre>
  </tr>
  <tr>
    <td>
      Run 2
    </td>
<pre><code>&lt;td&gt;
  1.562
&lt;/td&gt;

&lt;td&gt;
  0.953
&lt;/td&gt;

&lt;td&gt;
  0.985
&lt;/td&gt;

&lt;td&gt;
  1.594
&lt;/td&gt;
</code></pre>
  </tr>
  <tr>
    <td>
      Run 3
    </td>
<pre><code>&lt;td&gt;
  1.531
&lt;/td&gt;

&lt;td&gt;
  1.031
&lt;/td&gt;

&lt;td&gt;
  1.047
&lt;/td&gt;

&lt;td&gt;
  1.625
&lt;/td&gt;
</code></pre>
  </tr>
</table>
<p>In a chart:</p>
<figure>
    <img loading="lazy" src="https://s3-us-west-2.amazonaws.com/vnomad-public/blog_infra/2011/04/csv_comparizon.jpg"/> 
</figure>

<p><em><u>But wait ‚Äì there‚Äôs more üôÇ</u></em></p>
<p>Now let‚Äôs see if we can get even more results out of this. In the previous benchmark runs we did nothing with the CsvData we obtained, but that is not the case in real world right? now consider we add a single</p>
<pre>System.out.println("csvData = " + csvData);</pre>
<p>and this would always result in ‚ÄúcsvData = myCSvData‚Äù.</p>
<p>Running this in IDEA gives next results:</p>
<p>SplitBasedReader time: 14.634 sec.</p>
<p>StringBasedReader time: 13.086 sec</p>
<p>StringBasedReaderImproved time: 12.118 sec</p>
<p>RegexBasedReader time: 15.244 sec</p>
<p>**SAME but in console: **</p>
<p>SplitBasedReader time: 138.025 sec.</p>
<p>StringBasedReader time: 136.337 sec.</p>
<p>StringBasedReaderImproved time: 130.975 sec.</p>
<p>RegexBasedReader time: 131.146 sec.</p>
<p>So we see that the buffers and IO impact is immense.</p>
<p>And one more test. Lets assume out toString is smth. a little meaningful like</p>
<blockquote>
<pre>"CsvData{" + data[0] + data[1] + data[2];
</blockquote>
<p></pre></p>
<p>Now the times(idea env execution) are:</p>
<p>SplitBasedReader time: 21.655 sec.</p>
<p>StringBasedReader time: 9.772 sec.</p>
<p>StringBasedReaderImproved time: 9.256 sec.</p>
<p>RegexBasedReader time: 12.461 sec.</p>
<hr>
<p><strong>Bottom line:</strong></p></p>
<ul>
<li>
<p>While robust and effective Regex is not the fastest thing in the world;</p>
</li>
<li>
<p>working with relatively not-so-complex data is faster with ‚Äúsmaller‚Äù API‚Äôs;</p>
</li>
<li>
<p>;</p>
<p>IO is a bottleneck, not the parsing, usually.</p>
</li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://blog.vnomad.com/tags/java/">Java</a></li>
      <li><a href="https://blog.vnomad.com/tags/perf/">Perf</a></li>
      <li><a href="https://blog.vnomad.com/tags/csharp/">Csharp</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://blog.vnomad.com/posts/code/maven-compiler-plugin-causing-eclipse-projects-to-have-j2se-1-4-instead-of-configured-one/">
    <span class="title">¬´ Prev</span>
    <br>
    <span>maven-compiler-plugin causing eclipse projects to have j2se 1.4 instead of configured one</span>
  </a>
  <a class="next" href="https://blog.vnomad.com/posts/code/nokia-ovi-suite-sms-extract/">
    <span class="title">Next ¬ª</span>
    <br>
    <span>Nokia OVI suite &amp; sms extract.</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share String.split() VS String.startsWith() VS Regex simple performance comparison. on x"
            href="https://x.com/intent/tweet/?text=String.split%28%29%20VS%20String.startsWith%28%29%20VS%20Regex%20simple%20performance%20comparison.&amp;url=https%3a%2f%2fblog.vnomad.com%2fposts%2fcode%2fstring-split-vs-string-startswith-vs-regex-simple-performance-comparison%2f&amp;hashtags=java%2cperf%2ccsharp">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share String.split() VS String.startsWith() VS Regex simple performance comparison. on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fblog.vnomad.com%2fposts%2fcode%2fstring-split-vs-string-startswith-vs-regex-simple-performance-comparison%2f&amp;title=String.split%28%29%20VS%20String.startsWith%28%29%20VS%20Regex%20simple%20performance%20comparison.&amp;summary=String.split%28%29%20VS%20String.startsWith%28%29%20VS%20Regex%20simple%20performance%20comparison.&amp;source=https%3a%2f%2fblog.vnomad.com%2fposts%2fcode%2fstring-split-vs-string-startswith-vs-regex-simple-performance-comparison%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share String.split() VS String.startsWith() VS Regex simple performance comparison. on reddit"
            href="https://reddit.com/submit?url=https%3a%2f%2fblog.vnomad.com%2fposts%2fcode%2fstring-split-vs-string-startswith-vs-regex-simple-performance-comparison%2f&title=String.split%28%29%20VS%20String.startsWith%28%29%20VS%20Regex%20simple%20performance%20comparison.">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share String.split() VS String.startsWith() VS Regex simple performance comparison. on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.vnomad.com%2fposts%2fcode%2fstring-split-vs-string-startswith-vs-regex-simple-performance-comparison%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share String.split() VS String.startsWith() VS Regex simple performance comparison. on whatsapp"
            href="https://api.whatsapp.com/send?text=String.split%28%29%20VS%20String.startsWith%28%29%20VS%20Regex%20simple%20performance%20comparison.%20-%20https%3a%2f%2fblog.vnomad.com%2fposts%2fcode%2fstring-split-vs-string-startswith-vs-regex-simple-performance-comparison%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share String.split() VS String.startsWith() VS Regex simple performance comparison. on telegram"
            href="https://telegram.me/share/url?text=String.split%28%29%20VS%20String.startsWith%28%29%20VS%20Regex%20simple%20performance%20comparison.&amp;url=https%3a%2f%2fblog.vnomad.com%2fposts%2fcode%2fstring-split-vs-string-startswith-vs-regex-simple-performance-comparison%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share String.split() VS String.startsWith() VS Regex simple performance comparison. on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=String.split%28%29%20VS%20String.startsWith%28%29%20VS%20Regex%20simple%20performance%20comparison.&u=https%3a%2f%2fblog.vnomad.com%2fposts%2fcode%2fstring-split-vs-string-startswith-vs-regex-simple-performance-comparison%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>¬© Viktor Halitsyn</span> ¬∑ 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
