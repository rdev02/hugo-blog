

  
    
  


  




  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.30.2 with theme Tranquilpeak 0.4.2-BETA">
    <title>Custom selection server in PDF plugin</title>
    <meta name="author" content="Viktor Halitsyn">
    <meta name="keywords" content=", code, travel, immigration, ukraine, washington">

    <link rel="icon" href="/favicon.jpg">
    

    
    <meta name="description" content="Recently i was developing a feature for the Adobe&reg; Acrobat Reader&reg; plugin and come across an issue of selecting/highlighting annotations on the document based on some criteria e.g. if an annotation is positioned too close to the margin of the page&#8230; &#8211; bad you are :). Here i&#8217;ll post a tutorial like code for atchieving this goal for when trying to resolve that problem the only helpful information i foud was the Adobe Acrobat 7.">
    <meta property="og:description" content="Recently i was developing a feature for the Adobe&reg; Acrobat Reader&reg; plugin and come across an issue of selecting/highlighting annotations on the document based on some criteria e.g. if an annotation is positioned too close to the margin of the page&#8230; &#8211; bad you are :). Here i&#8217;ll post a tutorial like code for atchieving this goal for when trying to resolve that problem the only helpful information i foud was the Adobe Acrobat 7.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Custom selection server in PDF plugin">
    <meta property="og:url" content="blog.vnomad.com/code/custom-selection-server-in-pdf-plugin/">
    <meta property="og:site_name" content="Nomad&#39;s reflections">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Nomad&#39;s reflections">
    <meta name="twitter:description" content="Recently i was developing a feature for the Adobe&reg; Acrobat Reader&reg; plugin and come across an issue of selecting/highlighting annotations on the document based on some criteria e.g. if an annotation is positioned too close to the margin of the page&#8230; &#8211; bad you are :). Here i&#8217;ll post a tutorial like code for atchieving this goal for when trying to resolve that problem the only helpful information i foud was the Adobe Acrobat 7.">
    
      <meta name="twitter:creator" content="@rdev02">
    
    

    
    

    
      <meta property="og:image" content="//www.gravatar.com/avatar/d96a6dd84105118027bb67e3396ba7e4?s=640">
    

    
    
    

    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="/css/style-ryfmhpwcrntdiqds73k83etnsgyuksxmb6l5il9lddsjvmnzglrvqyzidzjl.min.css" />
    
    
      
        <link rel="stylesheet"  href="https://fonts.googleapis.com/css?family=Oswald|Roboto">
      
    

    
      
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-64535001-2', 'auto');
ga('send', 'pageview');
</script>

    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="3">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="/blog.vnomad.com/">Nomad&#39;s reflections</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="3">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="/#about">
          <img class="sidebar-profile-picture" src="//www.gravatar.com/avatar/d96a6dd84105118027bb67e3396ba7e4?s=110" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Viktor Halitsyn</h4>
        
          <h5 class="sidebar-profile-bio">Came a long way from Ukraine, still so much to go&hellip;</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/blog.vnomad.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/blog.vnomad.com/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/blog.vnomad.com/tags">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/blog.vnomad.com/archives">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/blog.vnomad.com/#about">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/rdev02" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://twitter.com/rdev02" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
      
      <span class="sidebar-button-desc">Twitter</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/blog.vnomad.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="3"
        class="
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      Custom selection server in PDF plugin
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2007-10-19T14:21:00Z">
        
  
  
  
  
    10/19/2007
  

      </time>
    
    
  
  
    <span>in</span>
    
      <a class="category-link" href="/blog.vnomad.com/categories/tech">tech</a>
    
  

  </div>

</div>
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <p>Recently i was developing a feature for the Adobe&reg; Acrobat Reader&reg; plugin and come across an issue of selecting/highlighting annotations on the document based on some criteria e.g. if an annotation is positioned too close to the margin of the page&#8230; &#8211; bad you are :). Here i&#8217;ll post a tutorial like code for atchieving this goal for when trying to resolve that problem the only helpful information i foud was the Adobe Acrobat 7.0.5 SDK.First i would like to say that i haven&#8217;t found better way(say another way) to make slection/highlight of an annotation that creating my own selection server for that annotation. It also has to be said that every single type in Acrobat that &#8220;can be highlighted&#8221; has its own selection server(of type AVDocSelectionServer) which in practise can be obtained if you know its &#8220;internal&#8221; name. For example if you want a selection server for type &#8220;Button&#8221; you can something as following:</p>

<pre><code class="language-cpp">AVDocGetSelectionServerByType(ASAtomFromString(&quot;Button&quot;));
</code></pre>

<p>There are selection servers for simple annotations but my annotation was a custom object, created by plug-in and thus didn&#8217;t have one. It didn&#8217;t prevent acrobat to use normal highlighting for it as when treating it as simple annotation in object editing mode, but the request was to provide highligting regardless of mode. So solution is to register the selection server. There is an example shipped with SDK of how to make custom selection servers but this example has a minor bug in it(it is configured so that selection will be drawn on every page whereas it has to be drawn only on the page where the object resides) and it doesnt take into consideration possibility of acrobat to change selection servers without notifying current selection server to lose its selection(for example when user press CTRL+A). So here we go with the code:First thing is to create a class which would be holding our selection and provide the selection type. To manage selections on different pages i created a simple class containinng list with page/data pairs and made it static for cross-page persistance. secondly implement the selection server. There is one workaround here in my code: to handle CTRL+A for simple objects on the page i use its selection server by injecting &#8220;losing selection&#8221; funtionality before server case takes place and then return to the normal application flow.This is definetely not a good way &#8211; but i found no other solution and this one is working:).</p>

<p>So here is the header file of the Selection Server</p>

<pre><code class="language-cpp">/*********************************************************************
ADOBE SYSTEMS INCORPORATED
Copyright (C) 1994-2003 Adobe Systems Incorporated
All rights reserved.
NOTICE: Adobe permits you to use, modify, and distribute this file
in accordance with the terms of the Adobe license agreement
accompanying it. If you have received this file from a source other
than Adobe, then your use, modification, or distribution of it
requires the prior written permission of Adobe.
---------------------------------------------------------------------
SelectionServer.h
*********************************************************************/

#ifndef PIDGETSELECTIONSERVER_H
#define PIDGETSELECTIONSERVER_H
#include &lt;list&gt;
#include &lt;map&gt;

typedef pair&lt;pdpage,list&lt;asfixedRect&gt;*&gt; PageSelection;
  /* CustomClassSelection
  ** ------------------------------------------------------
  **
  ** This is the structure used to store selection data for
  ** selections of type &quot;CustomClass&quot;. All callbacks in our
  ** AVDocSelectionServer can assume that selData is a
  ** pointer to one of these.
  */
  typedef struct _t_CustomClassSelection
  {
    PDAnnot annotToScrollTo;// the first annot that is highlighted
    list&lt;pageSelection&gt;* pageSelectionToHighlight;
    AVDoc currentDoc;
    bool isAnnotToScrollToSet;
  } CustomClassSelectionRec, *CustomClassSelection;

  // Pidget selection/highlight methods. These methods are
  // shared between the selection server and the AVTool.
  void InitializeCustomClassSelectionServer (void);
  /* SelectionServerGetType
  ** ------------------------------------------------------
  ** */
  /** We're registering a selection server of type &quot;CustomClass&quot;.
  **
  ** @return the selection server type.
  ** */
  static ACCB1 ASAtom ACCB2 CustomClassSelectionServerGetType ()
  {
    return ASAtomFromString (&quot;CustomClass&quot;);
  }

  ACCB1 void ACCB2 DrawCustomClassSelection (AVPageView pageView, AVDevRect *updateRect, void *data);
  extern ACCB1 void ACCB2 SelectionServerLosingSelection (AVDoc doc, void *selData, ASBool highlight);
  void* MySelectAllProc (AVDoc doc, void * selData);
  extern AVDocSelectionSelectAllProc prc;
  #endif 
  
  // !SELECTIONSERVER_H
  // ***************Its corresponding realization and helper 'drawing utils' file intended to actually draw the selection************
  /*********************************************************************
  ADOBE SYSTEMS INCORPORATED
  Copyright (C) 1994-2003 Adobe Systems Incorporated
  All rights reserved.
  NOTICE: Adobe permits you to use, modify, and distribute this file
  in accordance with the terms of the Adobe license agreement
  accompanying it. If you have received this file from a source other
  than Adobe, then your use, modification, or distribution of it
  requires the prior written permission of Adobe.
  -------------------------------------------------------------------*/ 
  /**
  file SelectionServer.cpp
  - The SelectionServer plug-in implements a selection server to handle
  pidgets. The pidgets selection tool allows users to select pidgetss by calling
  AVDocSetSelection() with a selection type of &quot;CustomClass&quot;.
  This call passes control to the selection server, which proceeds to
  highlight the pidget.
  - The selection server functionality is limited to getting, showing, and
  losing a selection.
  *********************************************************************/
  #ifndef MAC_PLATFORM
  #include &quot;PIHeaders.h&quot;
  #endif
  #include &quot;CommonHeaders.h&quot;
  #include &quot;SelectionServer.h&quot;
  #include &quot;Page.h&quot;
  
  /*-------------------------------------------------------
  Constants/Declarations
  -------------------------------------------------------*/
  static ASAtom CustomClass_K;
  static AVPageViewDrawProc cbDrawCustomClassSelection;
  static AVDocSelectionServerRec CustomClassSelectionServer;
  static AVDocSelectionSelectAllProc prc;
  /*-------------------------------------------------------
  AVDocSelectionServer Callbacks
  -------------------------------------------------------*/
  /* SelectionServerGettingSelection
  ** ------------------------------------------------------
  ** */ 
  //** This is the selection server's callback for when a
  //** selection is registered. 
  //**
  //** @param selData pointer to an CustomClassSelectionRec allocated 
  //** through ASmalloc. The LosingSelection callback will call 
  //** ASfree() on it.
  //**
  //** @see AVAppRegisterForPageViewDrawing
  //** */
  static ACCB1 void ACCB2 SelectionServerGettingSelection (AVDoc doc, void *selData, ASBool highlight)
  {
    ASAtom atm = ASAtomFromString(&quot;Authoring&quot;);
    AVDocSelectionServer srvr = AVDocGetSelectionServerByType(atm);
    prc = srvr-&gt;SelectAll;
    srvr-&gt;SelectAll = ASCallbackCreateProto (AVDocSelectionSelectAllProc, &amp;MySelectAllProc);
    
    
    AVPageView pageView = AVDocGetPageView(doc);
    CustomClassSelection isel = (CustomClassSelection)selData;
    // Draw the selection. It will only be drawn if the page
    // holding the selection is being displayed.
    DrawCustomClassSelection (pageView, NULL, selData);
    // Register the AVPageViewDrawProc so we can redraw the selection
    // when the page is updated.
    AVAppRegisterForPageViewDrawing (cbDrawCustomClassSelection, isel);
  }

  void* MySelectAllProc (AVDoc doc, void * selData){
    SelectionServerLosingSelection(AVAppGetActiveDoc(),Page::currentSelection,false);
    ASAtom atm = ASAtomFromString(&quot;Authoring&quot;);
    AVDocSelectionServer srvr = AVDocGetSelectionServerByType(atm);
    srvr-&gt;SelectAll = prc;
    return srvr-&gt;SelectAll(doc,selData);
  }
  /* SelectionServerLosingSelection
  ** ------------------------------------------------------
  ** */ 
  /** This is called whenever we have an active selection
  ** and the Viewer is attempting to change the selection
  ** to something else.
  **
  ** @see AVDocGetPageView
  ** @see AVAppUnregisterForPageViewDrawing
  ** @see PDPageGetNumber
  ** @see AVPageViewGetFirstVisiblePageNum
  ** @see AVPageViewGetLastVisiblePageNum
  ** @see AVPageViewRectToDevice
  ** @see AVPageViewInvalidateRect
  ** @see AVPageViewDrawNow
  ** @see PDPageRelease
  ** @see ASFree
  */
  ACCB1 void ACCB2 SelectionServerLosingSelection (AVDoc doc, void *selData, ASBool highlight)
  {
    AVPageView pageView = AVDocGetPageView(doc);
    CustomClassSelection isel = (CustomClassSelection)selData;
    ASAtom atm = ASAtomFromString(&quot;Authoring&quot;);
    AVDocSelectionServer srvr = AVDocGetSelectionServerByType(atm);
    srvr-&gt;SelectAll = prc;
    
    // Make sure that an exception doesn't prevent us from
    // releasing the PDPage.
    DURING
    // Unregister the AVPageViewDrawProc; there's no selection
    // to draw any more.
    AVAppUnregisterForPageViewDrawing (cbDrawCustomClassSelection);
    
    for(list&lt;pageSelection&gt;::iterator i = isel-&gt;pageSelectionToHighlight-&gt;begin(); i != isel-&gt;pageSelectionToHighlight-&gt;end(); i++)
    {
      PageSelection* iteratorSel = &amp;(*i);
      ASInt32 pageNum = PDPageGetNumber (iteratorSel-&gt;first);
      if ((pageNum &gt;= AVPageViewGetFirstVisiblePageNum(pageView)) &amp;&amp;
      (pageNum &lt;= AVPageViewGetLastVisiblePageNum(pageView)) &amp;#038;&amp;#038; highlight)
      {
        AVDevRect viewRect;
        for(list&lt;asfixedRect&gt;::iterator pageRect = iteratorSel-&gt;second-&gt;begin(); pageRect != iteratorSel-&gt;second-&gt;end();pageRect++)
        {
          AVPageViewRectToDevice (pageView, &amp;(*pageRect), &amp;viewRect);
          AVPageViewInvalidateRect (pageView, &amp;viewRect);
        }
        AVPageViewDrawNow (pageView);
      }
    }
    
    HANDLER
    END_HANDLER;
    // Release the page.
    
    for(list&lt;pageSelection&gt;::iterator i = isel-&gt;pageSelectionToHighlight-&gt;begin(); i != isel-&gt;pageSelectionToHighlight-&gt;end(); i++)
    {
      PDPageRelease (((PageSelection)(*i)).first);
    }
    // Free the selection data. Note that anyone calling AVDocSetSelection
    // for our selection server must have used ASmalloc to allocate the
    // memory, or this won't work.
    ASfree (isel);
  }
  /* SelectionServerShowSelection
  ** ------------------------------------------------------
  ** */ 
  /** If the user has strayed to a page different from the
  / ** selection, this callback will take the user to the
  ** correct page and scroll the selection into view.
  **
  ** @see AVPageViewBeginOperation
  ** @see AVPageViewGoTo
  ** @see AVPageViewRectToDevice
  ** @see AVPageViewScrollToRect
  ** @see AVPageViewEndOperation
  **/
  static ACCB1 void ACCB2 SelectionServerShowSelection (AVDoc doc, void *selData)
  {
  //currently not used
  }

  ASBool SelectionServerKeyDown (AVDoc doc, void * data, AVKeyCode key, AVFlagBits16 flags){
    if (key == 127) {
      AVDocClearSelection(AVAppGetActiveDoc(),false);
    }
    return false;
  }
  
  void* SelectionServerRemovedFromSelection (AVDoc doc, void * curData, void * remData, ASBool highlight)
  {
    int x = 10;
    return NULL;
  }

  /* InitializeSelectionServer
  ** ------------------------------------------------------
  ** */ 
  //** Create and register the selection server for pidgets.
  // **
  // ** @see ASAtomFromString
  // ** @see AVDocRegisterSelectionServer
  // ** */
  void InitializeCustomClassSelectionServer (void)
  {
    // Initialize our supporting globals.
    CustomClass_K = CustomClassSelectionServerGetType();
    cbDrawCustomClassSelection = ASCallbackCreateProto (AVPageViewDrawProc, DrawCustomClassSelection);
    // Set up the pidget selection server.
    memset (&amp;CustomClassSelectionServer, 0, sizeof(AVDocSelectionServerRec));
    CustomClassSelectionServer.size = sizeof(AVDocSelectionServerRec);
    // Currently, we only implement Getting, Losing and Showing selections.
    CustomClassSelectionServer.GetType =
    ASCallbackCreateProto (AVDocSelectionGetTypeProc, &amp;CustomClassSelectionServerGetType);
    CustomClassSelectionServer.GettingSelection =
    ASCallbackCreateProto (AVDocSelectionGettingSelectionProc, &amp;SelectionServerGettingSelection);
    CustomClassSelectionServer.LosingSelection =
    ASCallbackCreateProto (AVDocSelectionLosingSelectionProc, &amp;SelectionServerLosingSelection);
    CustomClassSelectionServer.ShowSelection =
    ASCallbackCreateProto (AVDocSelectionShowSelectionProc, &amp;SelectionServerShowSelection);
    CustomClassSelectionServer.KeyDown =
    ASCallbackCreateProto (AVDocSelectionKeyDownProc, &amp;SelectionServerKeyDown);
    CustomClassSelectionServer.RemovedFromSelection =
    ASCallbackCreateProto (AVDocSelectionRemovedFromSelectionProc, &amp;SelectionServerRemovedFromSelection);
    AVDocRegisterSelectionServer (&amp;CustomClassSelectionServer);
  }
</code></pre>

<p><p>
    // drawing utils implementation
  </p></p>

<pre><code class="language-cpp">/*********************************************************************
ADOBE SYSTEMS INCORPORATED
Copyright (C) 1994-2003 Adobe Systems Incorporated
All rights reserved.
NOTICE: Adobe permits you to use, modify, and distribute this file
in accordance with the terms of the Adobe license agreement
accompanying it. If you have received this file from a source other
than Adobe, then your use, modification, or distribution of it
requires the prior written permission of Adobe.
-------------------------------------------------------------------*/ 
/**
file SelectionServerDrawUtils.cpp
- Implementation to draw the highlight around the selected pidget.
*********************************************************************/
#ifndef MAC_PLATFORM
#include &quot;PIHeaders.h&quot;
#endif
#include &quot;CommonHeaders.h&quot;
#include &quot;SelectionServer.h&quot;
#include &quot;Resource.h&quot;
/*-------------------------------------------------------
Helper Methods
-------------------------------------------------------*/
/* DrawCustomClassSelectionHighlight
** ------------------------------------------------------
** */ 
/** Draws the selection on the pageview. Simply draws a
** rectangle around the pidget.
**
** @see AVPageViewSetColor
** @see AVPageViewDrawRectOutline
** */
static void DrawCustomClassSelectionHighlight (AVPageView pageView, const AVDevRect *selBounds)
{
  PDColorValueRec colorVal;
  // Define the color for our selection.
  colorVal.space = PDDeviceRGB ;
  colorVal.value[0] = ASInt32ToFixed(1);
  colorVal.value[1] = colorVal.value[2] = ASInt32ToFixed(0);

  // Set the drawing color for the pageview.
  AVPageViewSetColor (pageView, &amp;colorVal);
  // Draw the highlight.
  AVPageViewDrawRectOutline(pageView, selBounds, 2, NULL, 0);
}
/* DrawCustomClassSelection
** ------------------------------------------------------
** */ 
/** This is the AVPageViewDrawProc that draws the current
** selection. It is registered whenever the selection server's
** GettingSelection callback is called, and unregistered when
** the LosingSelection callback is called. The callback is
** created in InitializeSelectionServer().
**
** @see AVPageViewGetFirstVisiblePageNum
** @see AVPageViewGetLastVisiblePageNum
** @see AVPageViewRectToDevice
** */
ACCB1 void ACCB2 DrawCustomClassSelection (AVPageView pageView, AVDevRect *updateRect, void *data)
{

  CustomClassSelection isel = (CustomClassSelection)data;
  for(list&lt;pageSelection&gt;::iterator i = isel-&gt;pageSelectionToHighlight-&gt;begin(); i != isel-&gt;pageSelectionToHighlight-&gt;end(); i++)
  {
    PageSelection* iteratorSel = &amp;(*i);
    if(AVAppGetActiveDoc() != isel-&gt;currentDoc)
    {
      //this is not the document we need
      return;
    }
    ASInt32 pageNum = PDPageGetNumber (iteratorSel-&gt;first);

    DURING
    if ((pageNum &gt;= AVPageViewGetFirstVisiblePageNum(pageView)) &amp;&amp;
    (pageNum &lt;= AVPageViewGetLastVisiblePageNum(pageView))&amp;#038;&amp;#038;(pageNum == AVPageViewGetPageNum(pageView)))
    {
      // Convert the pidgets's bounding rect to device space.
      for(list&lt;asfixedRect&gt;::iterator pageRect = iteratorSel-&gt;second-&gt;begin(); pageRect != iteratorSel-&gt;second-&gt;end();pageRect++)
      {
        ASFixedRect rect = *pageRect;
        AVDevRect viewRect;
        AVPageViewRectToDevice (pageView, &amp;rect, &amp;viewRect);
        DrawCustomClassSelectionHighlight (pageView, &amp;viewRect);
      }
    }
    HANDLER
    END_HANDLER
  }
}
</code></pre>

<p><p>
    //we&#8217;ll also need some class to hold the selection class instance
  </p></p>

<pre><code class="language-cpp">#include &quot;CustomClassSelectionServer/SelectionServer.h&quot;
class Page:
{
    public:
    Page(Form *parent);
    ~Page();
    //other custom code

    static void InitSelection();
    static void SetSelection();
    static CustomClassSelection currentSelection;
};

typedef vector&lt;page&gt; PageVector;

//making the selection would be fairly easy:
Page::InitSelection();
for(every_page)
{
    if( need_selection )
    {
        / /add selection rectangle
        pageSlctn.second-&gt;push_back(boundingRect);
        if(!currentSelection-&gt;isAnnotToScrollToSet)
        {
            currentSelection-&gt;annotToScrollTo = annot;
            currentSelection-&gt;isAnnotToScrollToSet = true;
            //also add referrence to document to avoid cross document painting
            currentSelection-&gt;currentDoc = AVAppGetActiveDoc();
        }


        currentSelection-&gt;pageSelectionToHighlight-&gt;push_back(pageSlctn);
    }
}

Page::SetSelection();
</code></pre>

              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="/tags/c&#43;&#43;/">c&#43;&#43;</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="blog.vnomad.com/code/tiff-to-picture-box-in-pdf-plugin-adm-dialog/" data-tooltip="Tiff to Picture box in PDF plugin ADM dialog">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="blog.vnomad.com/code/nice-books-to-readoopood-agile-etc/" data-tooltip="Nice books to read[OOP,OOD, Agile etc.]">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=blog.vnomad.com/code/custom-selection-server-in-pdf-plugin/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=blog.vnomad.com/code/custom-selection-server-in-pdf-plugin/">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  </div>


            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2017 Viktor Halitsyn. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="3">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="blog.vnomad.com/code/tiff-to-picture-box-in-pdf-plugin-adm-dialog/" data-tooltip="Tiff to Picture box in PDF plugin ADM dialog">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="blog.vnomad.com/code/nice-books-to-readoopood-agile-etc/" data-tooltip="Nice books to read[OOP,OOD, Agile etc.]">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=blog.vnomad.com/code/custom-selection-server-in-pdf-plugin/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=blog.vnomad.com/code/custom-selection-server-in-pdf-plugin/">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="3">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=blog.vnomad.com%2Fcode%2Fcustom-selection-server-in-pdf-plugin%2F">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=blog.vnomad.com%2Fcode%2Fcustom-selection-server-in-pdf-plugin%2F">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="//www.gravatar.com/avatar/d96a6dd84105118027bb67e3396ba7e4?s=110" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Viktor Halitsyn</h4>
    
      <div id="about-card-bio">Came a long way from Ukraine, still so much to go&hellip;</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        software engineer
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Seattle, WA
      </div>
    
  </div>
</div>

    <div id="algolia-search-modal" class="modal-container">
  <div class="modal">
    <div class="modal-header">
      <span class="close-button"><i class="fa fa-close"></i></span>
      <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
        <span class="searchby-algolia-text text-color-light text-small">by</span>
        <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
      </a>
      <i class="search-icon fa fa-search"></i>
      <form id="algolia-search-form">
        <input type="text" id="algolia-search-input" name="search"
          class="form-control input--large search-input" placeholder="Search" />
      </form>
    </div>
    <div class="modal-body">
      <div class="no-result text-color-light text-center">no post found</div>
      <div class="results">
        
        
      </div>
    </div>
    <div class="modal-footer">
      <p class="results-count text-medium"
         data-message-zero="no post found"
         data-message-one="1 post found"
         data-message-other="{n} posts found">
         0 posts found
      </p>
    </div>
  </div>
</div>
    
  
    
    <div id="cover" style="background-image:url('https://vfybkq.bn1303.livefilestore.com/y4mGqBlcQGSIsuw6OFD-MyiXqyGa5dq-7DqQCgrXbP8kko6a9YT1Fr8ggCKZtEAdbDOqQa1eLNBJs9ZrWtimhlGd9Kum54jI9nWD-XvxFXe82LAKj11EtvUynlpcA6w__DOYjkaDPllOF-Xrs5acIf_p5kh7S9c8p_kGs3qjzXwko2tXxqSDt1Oe9himcpdzjiofihRH_N4cHAKRqiHvGui1g?width=3072&amp;height=1728&amp;cropmode=none');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="/js/script-yyopfo91nlhsxloqmnv4kvhxmnpmf7skhat5xwodlb2g9r5xvoc4cqqrobdj.min.js"></script>



<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>


  
    
      <script>
        var disqus_config = function () {
          this.page.url = 'blog.vnomad.com\/code\/custom-selection-server-in-pdf-plugin\/';
          
            this.page.identifier = '5468346569';
          
        };
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'vnomad';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  



    
  </body>
</html>

