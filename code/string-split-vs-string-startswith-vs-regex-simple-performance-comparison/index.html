<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.70.0 with theme Tranquilpeak 0.4.7-BETA">
<meta name="author" content="Viktor Halitsyn">
<meta name="keywords" content=", code, travel, immigration, ukraine, washington">
<meta name="description" content="Now really, what would be faster/more reliable for a typical not so complicated and not over-simple case? Yes the one we tend to deal with in our day-to-day work? For those impatient benchmarks are here.Reading a 100/1000-line file is not fun and I really think you shouldn‚Äôt bother choosing if you‚Äôre dealing with such volumes of data. But if you have to parse 320k-500k records lines, which, in fact, is not that large ‚Äì 320k of CSV data is ~ 12MB performance is considerable.">


<meta property="og:description" content="Now really, what would be faster/more reliable for a typical not so complicated and not over-simple case? Yes the one we tend to deal with in our day-to-day work? For those impatient benchmarks are here.Reading a 100/1000-line file is not fun and I really think you shouldn‚Äôt bother choosing if you‚Äôre dealing with such volumes of data. But if you have to parse 320k-500k records lines, which, in fact, is not that large ‚Äì 320k of CSV data is ~ 12MB performance is considerable.">
<meta property="og:type" content="article">
<meta property="og:title" content="String.split() VS String.startsWith() VS Regex simple performance comparison.">
<meta name="twitter:title" content="String.split() VS String.startsWith() VS Regex simple performance comparison.">
<meta property="og:url" content="http://blog.vnomad.com/code/string-split-vs-string-startswith-vs-regex-simple-performance-comparison/">
<meta property="twitter:url" content="http://blog.vnomad.com/code/string-split-vs-string-startswith-vs-regex-simple-performance-comparison/">
<meta property="og:site_name" content="Nomad&#39;s reflections">
<meta property="og:description" content="Now really, what would be faster/more reliable for a typical not so complicated and not over-simple case? Yes the one we tend to deal with in our day-to-day work? For those impatient benchmarks are here.Reading a 100/1000-line file is not fun and I really think you shouldn‚Äôt bother choosing if you‚Äôre dealing with such volumes of data. But if you have to parse 320k-500k records lines, which, in fact, is not that large ‚Äì 320k of CSV data is ~ 12MB performance is considerable.">
<meta name="twitter:description" content="Now really, what would be faster/more reliable for a typical not so complicated and not over-simple case? Yes the one we tend to deal with in our day-to-day work? For those impatient benchmarks are here.Reading a 100/1000-line file is not fun and I really think you shouldn‚Äôt bother choosing if you‚Äôre dealing with such volumes of data. But if you have to parse 320k-500k records lines, which, in fact, is not that large ‚Äì 320k of CSV data is ~ 12MB performance is considerable.">
<meta property="og:locale" content="en-us">

  
    <meta property="article:published_time" content="2011-04-19T14:45:00">
  
  
    <meta property="article:modified_time" content="2011-04-19T14:45:00">
  
  
  
    
      <meta property="article:section" content="tech">
    
      <meta property="article:section" content="code">
    
  
  
    
      <meta property="article:tag" content="java">
    
      <meta property="article:tag" content="perf">
    
      <meta property="article:tag" content="csharp">
    
  


<meta name="twitter:card" content="summary">

  <meta name="twitter:site" content="@rdev02">


  <meta name="twitter:creator" content="@rdev02">










  <meta property="og:image" content="https://www.gravatar.com/avatar/d96a6dd84105118027bb67e3396ba7e4?s=640">
  <meta property="twitter:image" content="https://www.gravatar.com/avatar/d96a6dd84105118027bb67e3396ba7e4?s=640">


    <title>String.split() VS String.startsWith() VS Regex simple performance comparison.</title>

    <link rel="icon" href="/favicon.jpg">
    

    
      <link rel="publisher" href="https://plus.google.com/&#43;victorhalitsyn">
    

    <link rel="canonical" href="http://blog.vnomad.com/code/string-split-vs-string-startswith-vs-regex-simple-performance-comparison/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="/css/style-twzjdbqhmnnacqs0pwwdzcdbt8yhv8giawvjqjmyfoqnvazl0dalmnhdkvp7.min.css" />
    
    
      
        <link rel="stylesheet"  href="https://fonts.googleapis.com/css?family=Oswald|Roboto">
      
    

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-64535001-2', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="3">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="/">Nomad&#39;s reflections</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="3">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="/#about">
          <img class="sidebar-profile-picture" src="https://www.gravatar.com/avatar/d96a6dd84105118027bb67e3396ba7e4?s=110" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Viktor Halitsyn</h4>
        
          <h5 class="sidebar-profile-bio">Came a long way from Ukraine, still so much to go&hellip;</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/">
    
      <i style="color:black" class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/categories">
    
      <i style="color:black" class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/tags">
    
      <i style="color:black" class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/archives">
    
      <i style="color:black" class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/#about">
    
      <i style="color:black" class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/rdev02" target="_blank" rel="noopener">
    
      <i style="color:black" class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://twitter.com/rdev02" target="_blank" rel="noopener">
    
      <i style="color:black" class="sidebar-button-icon fa fa-lg fa-twitter"></i>
      
      <span class="sidebar-button-desc">Twitter</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/index.xml">
    
      <i style="color:black" class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="3"
        class="
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      String.split() VS String.startsWith() VS Regex simple performance comparison.
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2011-04-19T14:45:00Z">
        
  
  
  
  
    04/19/2011
  

      </time>
    
    
  
  
    <span>in</span>
    
      <a class="category-link" href="/categories/tech">tech</a>, 
    
      <a class="category-link" href="/categories/code">code</a>
    
  

  </div>

</div>
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <p>Now really, what would be faster/more reliable for a typical not so complicated and not over-simple case? Yes the one we tend to deal with in our day-to-day work? For those impatient <a href="https://blog.vnomad.com/#benchmarks">benchmarks are here</a>.Reading a 100/1000-line file is not fun and I really think you shouldn‚Äôt bother choosing if you‚Äôre dealing with such volumes of data. But if you have to parse 320k-500k records lines, which, in fact, is not that large ‚Äì 320k of CSV data is ~ 12MB performance is considerable. So let‚Äôs start with data definition. Let‚Äôs assume we have data like</p>
<blockquote>
<p>1812332,‚ÄùString1‚Ä≥,‚ÄùString2‚Ä≥,‚ÄùString3‚Ä≥,16,</p>
</blockquote>
<blockquote>
<p>1812332,‚ÄùString1‚Ä≥,‚ÄùString2‚Ä≥,‚ÄùString3‚Ä≥,16,</p>
</blockquote>
<blockquote>
<p>1812332,‚ÄùString1‚Ä≥,‚ÄùString2, extra string‚Äù,‚ÄùString3‚Ä≥,16,</p>
</blockquote>
<p>Also we are going to start with the abstract ‚Äúblank‚Äù for csv reading like:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cs" data-lang="cs"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CsvStreamReader</span> implements Iterator&lt;CsvData&gt; {
    <span style="color:#66d9ef">protected</span> BufferedReader reader;

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * creates an new {@code CsvStreamReader}. Caller is responsible for stream management.
</span><span style="color:#75715e">     *
</span><span style="color:#75715e">     */</span>
    <span style="color:#66d9ef">public</span> CsvStreamReader() {
    }

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> CsvData next();

    <span style="color:#66d9ef">public</span> boolean hasNext() {
        <span style="color:#66d9ef">try</span> {
            <span style="color:#66d9ef">return</span> reader.ready();
        } <span style="color:#66d9ef">catch</span> (IOException e) {
            e.printStackTrace();
        }
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
    }

    @Deprecated
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#66d9ef">remove</span>() {
        <span style="color:#75715e">// not used
</span><span style="color:#75715e"></span>    }

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> setInputStream(InputStream inputStream){
        reader = <span style="color:#66d9ef">new</span> BufferedReader(<span style="color:#66d9ef">new</span> InputStreamReader(inputStream));
    }
}
</code></pre></div><p>And a simple data-holder like:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cs" data-lang="cs"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CsvData</span> {
    <span style="color:#66d9ef">private</span> String[] data;

    <span style="color:#66d9ef">public</span> CsvData(String... data) {
        <span style="color:#66d9ef">this</span>.data = <span style="color:#66d9ef">new</span> String[data.length];
        System.arraycopy(data, <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">this</span>.data, <span style="color:#ae81ff">0</span>, data.length);
    }

    <span style="color:#66d9ef">public</span> String getColumn(<span style="color:#66d9ef">int</span> index) {
        <span style="color:#66d9ef">return</span> data[index];
    }

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> getColumnCount() {
        <span style="color:#66d9ef">return</span> data.length;
    }

    @Override
    <span style="color:#66d9ef">public</span> String toString() {
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;CsvData{&#34;</span> +
          <span style="color:#e6db74">&#34;data=&#34;</span> + (data == <span style="color:#66d9ef">null</span> ? <span style="color:#66d9ef">null</span> : Arrays.asList(data)) +
          <span style="color:#e6db74">&#39;}&#39;</span>;
    }
}
</code></pre></div><p>Now the first and obvious way to read and parse the CSV would be smth like:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cs" data-lang="cs"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SplitBasedReader</span> extends CsvStreamReader {

    <span style="color:#66d9ef">public</span> CsvData next() {
        <span style="color:#66d9ef">try</span> {
            String line = reader.readLine();
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> CsvData(line.split(<span style="color:#e6db74">&#34;,&#34;</span>));
        } <span style="color:#66d9ef">catch</span> (IOException e) {
            e.printStackTrace();
        }
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>;
    }
}
</code></pre></div><p>This looks fairly good with one lil‚Äô problem: it doesn‚Äôt work good. If we take the last line with ‚ÄúString2, extra string‚Äù we see that the split would play a bad trick with us breaking the data consistency.</p>
<p>A quick fix would suggest smth like:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cs" data-lang="cs"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">StringBasedReader</span> extends CsvStreamReader {
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> final String QUOTE = <span style="color:#e6db74">&#34;&#34;&#34;;
</span><span style="color:#e6db74"></span>
    @Override
    <span style="color:#66d9ef">public</span> CsvData next() {
        <span style="color:#66d9ef">try</span> {
            List&lt;String&gt; data = <span style="color:#66d9ef">new</span> ArrayList&lt;String&gt;();
            final String line = reader.readLine();
            <span style="color:#66d9ef">int</span> commaStart = <span style="color:#ae81ff">0</span>;
            <span style="color:#66d9ef">int</span> commaEnd = <span style="color:#ae81ff">0</span>;
            StringBuffer possibleToken = <span style="color:#66d9ef">new</span> StringBuffer();

            <span style="color:#66d9ef">while</span> (commaEnd &gt;= <span style="color:#ae81ff">0</span>) {
                commaEnd = line.indexOf(<span style="color:#e6db74">&#39;,&#39;</span>, commaStart + <span style="color:#ae81ff">1</span>);
                <span style="color:#66d9ef">if</span> (commaEnd &lt; <span style="color:#ae81ff">0</span>) {
                    <span style="color:#66d9ef">break</span>;
                }
                final String possibleColumn = line.substring(commaStart, commaEnd);
                possibleToken.append(possibleColumn);
                commaStart = commaEnd + <span style="color:#ae81ff">1</span>;

                final <span style="color:#66d9ef">int</span> length = possibleToken.length();

                boolean columnIsOpen = (possibleColumn.startsWith(QUOTE)) &amp;&amp; (!(possibleColumn.endsWith(QUOTE)));
                <span style="color:#66d9ef">if</span> (!columnIsOpen) {
                    data.<span style="color:#66d9ef">add</span>(possibleToken.toString());
                    possibleToken.delete(<span style="color:#ae81ff">0</span>, length);
                }
            }

            <span style="color:#66d9ef">if</span> (possibleToken.length() != <span style="color:#ae81ff">0</span>) {
                data.<span style="color:#66d9ef">add</span>(possibleToken.toString());
            }

            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> CsvData(data.toArray(<span style="color:#66d9ef">new</span> String[]{}));
        } <span style="color:#66d9ef">catch</span> (IOException ioex) {
            ioex.printStackTrace();
        }
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>;
    }
}
</code></pre></div><p>Well yeah, but having string.startsWith checking on String all this takes int account variable length which in fact we do not care about‚Ä¶ sounds wasteful. Let‚Äôs improve it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cs" data-lang="cs"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">StringBasedReaderImproved</span> extends CsvStreamReader {
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> final <span style="color:#66d9ef">char</span> QUOTE = <span style="color:#e6db74">&#39;&#34;&#39;</span>;

    @Override
    <span style="color:#66d9ef">public</span> CsvData next() {
        <span style="color:#66d9ef">try</span> {
            List&lt;String&gt; data = <span style="color:#66d9ef">new</span> ArrayList&lt;String&gt;();
            final String line = reader.readLine();
            <span style="color:#66d9ef">int</span> commaStart = <span style="color:#ae81ff">0</span>;
            <span style="color:#66d9ef">int</span> commaEnd = <span style="color:#ae81ff">0</span>;
            StringBuffer possibleToken = <span style="color:#66d9ef">new</span> StringBuffer();

            <span style="color:#66d9ef">while</span> (commaEnd &gt;= <span style="color:#ae81ff">0</span>) {
                commaEnd = line.indexOf(<span style="color:#e6db74">&#39;,&#39;</span>, commaStart + <span style="color:#ae81ff">1</span>);
                <span style="color:#66d9ef">if</span> (commaEnd &lt; <span style="color:#ae81ff">0</span>) {
                    <span style="color:#66d9ef">break</span>;
                }
                possibleToken.append(line.substring(commaStart, commaEnd));
                commaStart = commaEnd + <span style="color:#ae81ff">1</span>;

                final <span style="color:#66d9ef">int</span> length = possibleToken.length();
                boolean columnIsOpen = (possibleToken.charAt(<span style="color:#ae81ff">0</span>) == QUOTE) &amp;&amp; (!(possibleToken.charAt(length - <span style="color:#ae81ff">1</span>) == QUOTE));
                <span style="color:#66d9ef">if</span> (!columnIsOpen) {
                    data.<span style="color:#66d9ef">add</span>(possibleToken.toString());
                    possibleToken.delete(<span style="color:#ae81ff">0</span>, length);
                }
            }

            <span style="color:#66d9ef">if</span> (possibleToken.length() != <span style="color:#ae81ff">0</span>) {
                data.<span style="color:#66d9ef">add</span>(possibleToken.toString());
            }

            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> CsvData(data.toArray(<span style="color:#66d9ef">new</span> String[]{}));
        } <span style="color:#66d9ef">catch</span> (IOException ioex) {
            ioex.printStackTrace();
        }
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>;
    }
}
</code></pre></div><p>OKAY! now it a char and <code>StringBuffer</code>. Looks like we‚Äôve done a great job! Awesome‚Ä¶. although a bit magical. It‚Äôs not rocket science but still it‚Äôs not pleasant to read. What else might we suggest? Regex.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cs" data-lang="cs"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RegexBasedReader</span> extends CsvStreamReader {
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> final String RE_ANY_INSIDE_QUOTES = <span style="color:#e6db74">&#34;&#34;</span>([^<span style="color:#e6db74">&#34;]*)&#34;&#34;;
</span><span style="color:#e6db74"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> final String RE_ANY_WITHOUT_COMMAS = <span style="color:#e6db74">&#34;([^,]*)&#34;</span>;
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> final String RE_ANY = <span style="color:#e6db74">&#34;(&#34;</span> + RE_ANY_INSIDE_QUOTES + <span style="color:#e6db74">&#34;|&#34;</span> + RE_ANY_WITHOUT_COMMAS + <span style="color:#e6db74">&#34;)&#34;</span>;
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> final String RE_6_DIGIT_GROUP = <span style="color:#e6db74">&#34;(\d{6})&#34;</span>;

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> final String CSV_REGEX = <span style="color:#e6db74">&#34;^&#34;</span> + RE_6_DIGIT_GROUP + <span style="color:#e6db74">&#34;,&#34;</span> + RE_ANY + <span style="color:#e6db74">&#34;,&#34;</span> + RE_ANY + <span style="color:#e6db74">&#34;,&#34;</span> + RE_ANY + <span style="color:#e6db74">&#34;,&#34;</span> + RE_ANY + <span style="color:#e6db74">&#34;,$&#34;</span>;


    <span style="color:#66d9ef">protected</span> final Pattern pattern;

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * {@inheritDoc}
</span><span style="color:#75715e">     */</span>
    <span style="color:#66d9ef">public</span> RegexBasedReader() {
        pattern = Pattern.compile(CSV_REGEX);
    }

    <span style="color:#66d9ef">public</span> CsvData next() {
        <span style="color:#66d9ef">try</span> {
            List&lt;String&gt; data = <span style="color:#66d9ef">new</span> ArrayList&lt;String&gt;();
            final String line = reader.readLine();
            final Matcher matcher = pattern.matcher(line);
            matchDataToColumns(data, matcher);

            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> CsvData(data.toArray(<span style="color:#66d9ef">new</span> String[]{}));
        } <span style="color:#66d9ef">catch</span> (IOException e) {
            e.printStackTrace();
        }
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>;
    }

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * @param data
</span><span style="color:#75715e">     * @param matcher
</span><span style="color:#75715e">     */</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> matchDataToColumns(List&lt;String&gt; data, Matcher matcher) {
        <span style="color:#66d9ef">if</span> (matcher.matches()) {
            final <span style="color:#66d9ef">int</span> groupCount = matcher.groupCount();
            assert groupCount == <span style="color:#ae81ff">13</span> : <span style="color:#e6db74">&#34;Matched an invalid string - regex should be revised&#34;</span>;

            final String data1 = matcher.<span style="color:#66d9ef">group</span>(<span style="color:#ae81ff">1</span>);
            assert data1 != <span style="color:#66d9ef">null</span> : <span style="color:#e6db74">&#34;data1 should always be present&#34;</span>;
            data.<span style="color:#66d9ef">add</span>(data1);

            String data2 = matcher.<span style="color:#66d9ef">group</span>(<span style="color:#ae81ff">3</span>);
            <span style="color:#66d9ef">if</span> (data2 == <span style="color:#66d9ef">null</span>) {
                data2 = matcher.<span style="color:#66d9ef">group</span>(<span style="color:#ae81ff">4</span>);
            }
            assert data2 != <span style="color:#66d9ef">null</span> : <span style="color:#e6db74">&#34;data2 should somehow be present&#34;</span>;
            data.<span style="color:#66d9ef">add</span>(data2);

            String data3 = matcher.<span style="color:#66d9ef">group</span>(<span style="color:#ae81ff">6</span>);
            <span style="color:#66d9ef">if</span> (data3 == <span style="color:#66d9ef">null</span>) {
                data3 = matcher.<span style="color:#66d9ef">group</span>(<span style="color:#ae81ff">7</span>);
            }
            assert data3 != <span style="color:#66d9ef">null</span> : <span style="color:#e6db74">&#34;data3 should somehow be present&#34;</span>;
            data.<span style="color:#66d9ef">add</span>(data3);

            String data4 = matcher.<span style="color:#66d9ef">group</span>(<span style="color:#ae81ff">9</span>);
            <span style="color:#66d9ef">if</span> (data4 == <span style="color:#66d9ef">null</span>) {
                data4 = matcher.<span style="color:#66d9ef">group</span>(<span style="color:#ae81ff">10</span>);
            }
            assert data4 != <span style="color:#66d9ef">null</span> : <span style="color:#e6db74">&#34;data4 should somehow be present&#34;</span>;
            data.<span style="color:#66d9ef">add</span>(data4);

            String data5 = matcher.<span style="color:#66d9ef">group</span>(<span style="color:#ae81ff">12</span>);
            <span style="color:#66d9ef">if</span> (data5 == <span style="color:#66d9ef">null</span>) {
                data5 = matcher.<span style="color:#66d9ef">group</span>(<span style="color:#ae81ff">13</span>);
            }
            assert data5 != <span style="color:#66d9ef">null</span> : <span style="color:#e6db74">&#34;data5 should somehow be present&#34;</span>;
            data.<span style="color:#66d9ef">add</span>(data5);
        }
    }
}
</code></pre></div><p>That looks like Chuck Norris would be proud. Strong and reliable checking, precompiled patern, groups of data, many cases handled same way‚Ä¶ room for extension etc.</p>
<ul>
<li>
<ul>
<li>*Now lets look at the</li>
</ul>
</li>
</ul>
<p><strong>benchmarks</strong> reading over <strong>500k</strong> lines:</p>
</p> 
<pre><code>public class Test2 {
    static List&lt;string&gt; times = new ArrayList&lt;string&gt;(4);

    public static void main(String[] args) throws IOException {

        read320KRecords(new SplitBasedReader());
        read320KRecords(new StringBasedReader());
        read320KRecords(new StringBasedReaderImproved());
        read320KRecords(new RegexBasedReader());
}

    private static void read320KRecords(CsvStreamReader reader) throws IOException {
        InputStream inputStream = Test2.class.getResourceAsStream(&quot;/CardInfo.csv&quot;);
        reader.setInputStream(inputStream);
        long timeStart = System.currentTimeMillis();
        while (reader.hasNext()) {
            CsvData csvData = reader.next();
        }
        long timeEnd = System.currentTimeMillis();
        times.add(reader.toString() + &quot;  time: &quot; + (new DecimalFormat(&quot;#.####&quot;)).format(new Double(
          (timeEnd - timeStart) / 1000.0)) + &quot; sec.&quot;);
        inputStream.close();
    }
}
</code></pre><p><a href="http://www.blogger.com/post-create.g?blogID=4242186654644920321" name="benchmarks">Output <i>run from IntellyJ Idea</i>:</a></p>
<table border="1" cellpadding="0" cellspacing="0">
  <tr>
    <td>
<pre><code>&lt;/td&gt;

&lt;td&gt;
  &lt;b&gt;SplitBasedReader&lt;/b&gt;
&lt;/td&gt;

&lt;td&gt;
  &lt;b&gt;StringBasedReader&lt;/b&gt;
&lt;/td&gt;

&lt;td&gt;
  &lt;b&gt;StringBasedReaderImproved&lt;/b&gt;
&lt;/td&gt;

&lt;td&gt;
  &lt;b&gt;RegexBasedReader&lt;/b&gt;
&lt;/td&gt;
</code></pre>
  </tr>
  <tr>
    <td>
      Run 1
    </td>
<pre><code>&lt;td&gt;
  1.468
&lt;/td&gt;

&lt;td&gt;
  0.968
&lt;/td&gt;

&lt;td&gt;
  0.984
&lt;/td&gt;

&lt;td&gt;
  1.593
&lt;/td&gt;
</code></pre>
  </tr>
  <tr>
    <td>
      Run 2
    </td>
<pre><code>&lt;td&gt;
  1.562
&lt;/td&gt;

&lt;td&gt;
  0.953
&lt;/td&gt;

&lt;td&gt;
  0.985
&lt;/td&gt;

&lt;td&gt;
  1.594
&lt;/td&gt;
</code></pre>
  </tr>
  <tr>
    <td>
      Run 3
    </td>
<pre><code>&lt;td&gt;
  1.531
&lt;/td&gt;

&lt;td&gt;
  1.031
&lt;/td&gt;

&lt;td&gt;
  1.047
&lt;/td&gt;

&lt;td&gt;
  1.625
&lt;/td&gt;
</code></pre>
  </tr>
</table>
<p>In a chart:</p>


 
  
  
  
  
    
  
    
      
    
  

<div class="figure left" >
  
    <a class="fancybox" href="https://s3-us-west-2.amazonaws.com/vnomad-public/blog_infra/2011/04/csv_comparizon.jpg" data-fancybox-group="">
  
    <img class="fig-img" src="https://s3-us-west-2.amazonaws.com/vnomad-public/blog_infra/2011/04/csv_comparizon.jpg" >
  
    </a>
  
  
</div>

<p><em><u>But wait ‚Äì there‚Äôs more üôÇ</u></em></p>
<p>Now let‚Äôs see if we can get even more results out of this. In the previous benchmark runs we did nothing with the CsvData we obtained, but that is not the case in real world right? now consider we add a single</p>
<pre>System.out.println("csvData = " + csvData);</pre>
<p>and this would always result in ‚ÄúcsvData = myCSvData‚Äù.</p>
<p>Running this in IDEA gives next results:</p>
<p>SplitBasedReader time: 14.634 sec.</p>
<p>StringBasedReader time: 13.086 sec</p>
<p>StringBasedReaderImproved time: 12.118 sec</p>
<p>RegexBasedReader time: 15.244 sec</p>
<p>**SAME but in console: **</p>
<p>SplitBasedReader time: 138.025 sec.</p>
<p>StringBasedReader time: 136.337 sec.</p>
<p>StringBasedReaderImproved time: 130.975 sec.</p>
<p>RegexBasedReader time: 131.146 sec.</p>
<p>So we see that the buffers and IO impact is immense.</p>
<p>And one more test. Lets assume out toString is smth. a little meaningful like</p>
<blockquote>
<pre>"CsvData{" + data[0] + data[1] + data[2];
</blockquote>
<p></pre></p>
<p>Now the times(idea env execution) are:</p>
<p>SplitBasedReader time: 21.655 sec.</p>
<p>StringBasedReader time: 9.772 sec.</p>
<p>StringBasedReaderImproved time: 9.256 sec.</p>
<p>RegexBasedReader time: 12.461 sec.</p>
<hr>
<p>**Bottom line:**</p></p>
<ul>
<li>
<p>While robust and effective Regex is not the fastest thing in the world;</p>
</li>
<li>
<p>working with relatively not-so-complex data is faster with ‚Äúsmaller‚Äù API‚Äôs;</p>
</li>
<li>
<p>;</p>
<p>IO is a bottleneck, not the parsing, usually.</p>
</li>
</ul>

              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="/tags/java/">java</a>

  <a class="tag tag--primary tag--small" href="/tags/perf/">perf</a>

  <a class="tag tag--primary tag--small" href="/tags/csharp/">csharp</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="/code/maven-compiler-plugin-causing-eclipse-projects-to-have-j2se-1-4-instead-of-configured-one/" data-tooltip="maven-compiler-plugin causing eclipse projects to have j2se 1.4 instead of configured one">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="/code/nokia-ovi-suite-sms-extract/" data-tooltip="Nokia OVI suite &amp; sms extract.">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.vnomad.com/code/string-split-vs-string-startswith-vs-regex-simple-performance-comparison/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://blog.vnomad.com/code/string-split-vs-string-startswith-vs-regex-simple-performance-comparison/">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2020 Viktor Halitsyn. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="3">
        <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="/code/maven-compiler-plugin-causing-eclipse-projects-to-have-j2se-1-4-instead-of-configured-one/" data-tooltip="maven-compiler-plugin causing eclipse projects to have j2se 1.4 instead of configured one">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="/code/nokia-ovi-suite-sms-extract/" data-tooltip="Nokia OVI suite &amp; sms extract.">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.vnomad.com/code/string-split-vs-string-startswith-vs-regex-simple-performance-comparison/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://blog.vnomad.com/code/string-split-vs-string-startswith-vs-regex-simple-performance-comparison/">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="3">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fblog.vnomad.com%2Fcode%2Fstring-split-vs-string-startswith-vs-regex-simple-performance-comparison%2F">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=http%3A%2F%2Fblog.vnomad.com%2Fcode%2Fstring-split-vs-string-startswith-vs-regex-simple-performance-comparison%2F">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.gravatar.com/avatar/d96a6dd84105118027bb67e3396ba7e4?s=110" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Viktor Halitsyn</h4>
    
      <div id="about-card-bio">Came a long way from Ukraine, still so much to go&hellip;</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        software engineer
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Seattle, WA
      </div>
    
  </div>
</div>

    

    
  
    <div id="cover" style="background-image:url('https://s3-us-west-2.amazonaws.com/vnomad-public/blog_infra/wp_back3.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="/js/script-pcw6v3xilnxydl1vddzazdverrnn9ctynvnxgwho987mfyqkuylcb1nlt.min.js"></script>


<script lang="javascript">
window.onload = updateMinWidth;
window.onresize = updateMinWidth;
document.getElementById("sidebar").addEventListener("transitionend", updateMinWidth);
function updateMinWidth() {
  var sidebar = document.getElementById("sidebar");
  var main = document.getElementById("main");
  main.style.minWidth = "";
  var w1 = getComputedStyle(main).getPropertyValue("min-width");
  var w2 = getComputedStyle(sidebar).getPropertyValue("width");
  var w3 = getComputedStyle(sidebar).getPropertyValue("left");
  main.style.minWidth = `calc(${w1} - ${w2} - ${w3})`;
}
</script>

<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>


  
    
      <script>
        var disqus_config = function () {
          this.page.url = 'http:\/\/blog.vnomad.com\/code\/string-split-vs-string-startswith-vs-regex-simple-performance-comparison\/';
          
            this.page.identifier = '\/code\/string-split-vs-string-startswith-vs-regex-simple-performance-comparison\/'
          
        };
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'vnomad';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  




    
  </body>
</html>

